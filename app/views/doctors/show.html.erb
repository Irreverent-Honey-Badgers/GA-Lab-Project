<h1> Waiting Roomm </h1>

<% if notice %>
<p class="alert alert-success"><%= notice %></p>
<% end %>
<% if alert %>
<p class="alert alert-danger"><%= alert %></p>
<% end %>


<p class="navbar-text pull-right">
  <% if doctor_signed_in? %>
  Logged in as <strong><%= current_doctor.email %></strong><br>
  <%= link_to 'edit profile', edit_doctor_registration_path, :class => 'navbar-link', id: "edit"%> |
  <%= link_to "logout", destroy_doctor_session_path, method: :delete, :class => 'navbar-link', id: "logout" %>
  <% else %>
  <%= link_to "Sign up", new_doctor_registration_path, :class => 'navbar-link'  %> |
  <%= link_to "Login", new_doctor_session_path, :class => 'navbar-link'  %>
  <% end %>
</p>

<h1> Checked In </h1>
<table class="checkedIn">
</table>

<h1> En Route </h1>
<table class="enRoute">
</table>

<h1> Later Appointments </h1>
<table class="laterAppt">
</table>

<h1> Completed </h1>
<table class="Completed">
</table>

<%= link_to 'Calendar', doctors_path %>

<script>
$(function(){

  var m = function(){
    $('.enRoute').on('click','#arrived_checkbox',changeToCheckedIn)


    $.get('/doctors/' + '<%= current_doctor.id %>' + '/get_patient').done(function(data){
      console.log("mooo");
    var descripRow = $('<tr>').attr('id', 'descripRow');
      var enRouteRow = $('<tr>').attr('id', 'enRouteRow');
      var appt = $('<td>').attr('id', 'appt').text("Appt");
      var patientName = $('<td>').attr('id', 'name').text("Name");
      var purpose = $('<td>').attr('id', 'purpose').text("Purpose");
      var appt2 = $('<td>').attr('id', 'appt').text("Appt");
      var patientName2 = $('<td>').attr('id', 'name').text("Name");
      var purpose2 = $('<td>').attr('id', 'purpose').text("Purpose");
      var checkbox = $('<td>').attr('id', 'checkbox').text("Checkbox");
      var descripObject = descripRow.append(appt).append(patientName).append(purpose);
      var eta = $('<td>').attr('id', 'eta').text("ETA");
      var enRouteObject= enRouteRow.append(appt2).append(patientName2).append(purpose2).append(eta).append(checkbox);
      $('.enRoute').append(enRouteObject);
      $('.laterAppt').append(descripObject);
      data.forEach(function(element, index, array){
        var patientAppt = $('<tr>').attr('id', 'patientAppt').data('patient-id', element.patient.id);
          var start = $('<td>').attr('id', 'start').text(element.start);
          var name = $('<td>').attr('id', 'name').text(element.patient.first_name + ' ' + element.patient.last_name);
          var title = $('<td>').attr('id', 'purpose').text(element.title);
          var patientObject = patientAppt.append(start).append(name).append(title);
      // debugger;
          if (element.eta != null) {
            $('.enRoute').append(patientObject);
            var eta = $('<td>').attr('id', 'eta').text(element.eta);
            var checkbox = $('<input>').attr("id","arrived_checkbox").attr("type","checkbox");
            patientObject.append(eta).append(checkbox).append(checkbox);
          }
          else {
            $('.laterAppt').append(patientObject);
          }
        });
    });
  $('.enRoute').empty();
  $('.laterAppt').empty();
  };

  function changeToCheckedIn(){
    var patientObject = $(this).parent();
    $('.checkedIn').append(patientObject);
    $.ajax({
      url: '/doctors/' + <%= current_doctor.id %> + '/appointments/patient/' + $(this).parent().data().patientId,
      type: 'DELETE',
      success: function() {
        $(this).remove();
      }
    });

  }



  setInterval(m,5000);
});



</script>
